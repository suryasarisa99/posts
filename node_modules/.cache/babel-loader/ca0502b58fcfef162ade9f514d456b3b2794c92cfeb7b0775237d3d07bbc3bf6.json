{"ast":null,"code":"var _jsxFileName = \"/home/surya/ws/node/posts/client/src/pages/Postslist.js\",\n  _s = $RefreshSig$();\nimport axios from \"axios\";\nimport { useState, useEffect, useReducer, useContext } from \"react\";\nimport immer from \"immer\";\nimport Post from \"../components/Post\";\nimport ReactDOM from \"react-dom\";\nimport Create from \"../components/Create\";\nimport { FaPlus } from \"react-icons/fa\";\nimport { useNavigate } from \"react-router-dom\";\n// let SERVER_URI = \"http://192.168.0.169:3000\";\nimport authContext from \"../context/authContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nlet SERVER_URI = process.env.REACT_APP_SERVER_URI;\nfunction Postlist() {\n  _s();\n  var _state$posts;\n  function reducer(state, action) {\n    if (action.type === \"updateImg\") {\n      state.posts[action.index].imageUrl = action.payload;\n    } else if (action.type === \"setPosts\") {\n      state.posts = action.payload;\n    } else if (action.type === \"setLikes\") {\n      state.posts[action.index].likesCount = action.likesCount;\n      state.posts[action.index].liked = action.liked;\n    }\n  }\n  const [showCreate, setShowCreate] = useState(false);\n  const [state, dispatch] = useReducer(immer(reducer), {\n    posts: []\n  });\n  useEffect(() => {\n    getPosts();\n  }, []);\n  function getPosts() {\n    axios.get(`${SERVER_URI}/p/post`, {\n      withCredentials: true\n    }).then(res => {\n      dispatch({\n        type: \"setPosts\",\n        payload: res.data.posts\n      });\n      console.log(res.data);\n      res.data.posts.forEach((post, ind) => getPostImg(post.post, ind));\n    });\n  }\n  function getPostImg(post, ind) {\n    axios.get(`${SERVER_URI}/p/post-img/${post}`, {\n      withCredentials: true,\n      responseType: \"blob\"\n    }).then(res => {\n      const url = URL.createObjectURL(res.data);\n      dispatch({\n        type: \"updateImg\",\n        payload: url,\n        index: ind\n      });\n    });\n  }\n  let posts = (_state$posts = state.posts) === null || _state$posts === void 0 ? void 0 : _state$posts.map((post, ind) => {\n    return /*#__PURE__*/_jsxDEV(Post, {\n      post: {\n        ...post,\n        editable: true\n      },\n      logined: true,\n      editable: true\n    }, post.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 7\n    }, this);\n  });\n  function handleSubmit(e) {\n    e.preventDefault();\n    let form = e.target;\n    let data = {\n      post: form.post.files[0],\n      caption: form.caption.value\n    };\n    setShowCreate(false);\n    console.log(form.post.files[0]);\n    axios.post(`${SERVER_URI}/p/post`, data, {\n      withCredentials: true,\n      headers: {\n        \"Content-Type\": \"multipart/form-data\"\n      }\n    }).then(res => {\n      getPosts();\n    });\n  }\n  useEffect(() => {\n    if (showCreate) {\n      window.addEventListener(\"scroll\", () => {\n        setShowCreate(false);\n      });\n    }\n  }, [showCreate]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [posts, !showCreate && /*#__PURE__*/ReactDOM.createPortal( /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"\",\n      style: {\n        position: \"fixed\",\n        bottom: \"20px\",\n        right: \"40px\"\n      },\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setShowCreate(true),\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rounded-full border-2 p-4 bg-inherit\",\n          children: /*#__PURE__*/_jsxDEV(FaPlus, {\n            style: {\n              width: \"25px\",\n              height: \"25px\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 11\n    }, this), document.querySelector(\".overlay\")), showCreate && /*#__PURE__*/_jsxDEV(Create, {\n      handleSubmit: handleSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 22\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-18\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s(Postlist, \"20CTetlH3uNvu2l/bOzPYaTdp2E=\");\n_c = Postlist;\nexport default Postlist;\nvar _c;\n$RefreshReg$(_c, \"Postlist\");","map":{"version":3,"names":["axios","useState","useEffect","useReducer","useContext","immer","Post","ReactDOM","Create","FaPlus","useNavigate","authContext","jsxDEV","_jsxDEV","Fragment","_Fragment","SERVER_URI","process","env","REACT_APP_SERVER_URI","Postlist","_s","_state$posts","reducer","state","action","type","posts","index","imageUrl","payload","likesCount","liked","showCreate","setShowCreate","dispatch","getPosts","get","withCredentials","then","res","data","console","log","forEach","post","ind","getPostImg","responseType","url","URL","createObjectURL","map","editable","logined","id","fileName","_jsxFileName","lineNumber","columnNumber","handleSubmit","e","preventDefault","form","target","files","caption","value","headers","window","addEventListener","children","createPortal","className","style","position","bottom","right","onClick","width","height","document","querySelector","_c","$RefreshReg$"],"sources":["/home/surya/ws/node/posts/client/src/pages/Postslist.js"],"sourcesContent":["import axios from \"axios\";\nimport { useState, useEffect, useReducer, useContext } from \"react\";\nimport immer from \"immer\";\nimport Post from \"../components/Post\";\nimport ReactDOM from \"react-dom\";\nimport Create from \"../components/Create\";\nimport { FaPlus } from \"react-icons/fa\";\nimport { useNavigate } from \"react-router-dom\";\n// let SERVER_URI = \"http://192.168.0.169:3000\";\nimport authContext from \"../context/authContext\";\nlet SERVER_URI = process.env.REACT_APP_SERVER_URI;\nfunction Postlist() {\n  function reducer(state, action) {\n    if (action.type === \"updateImg\") {\n      state.posts[action.index].imageUrl = action.payload;\n    } else if (action.type === \"setPosts\") {\n      state.posts = action.payload;\n    } else if (action.type === \"setLikes\") {\n      state.posts[action.index].likesCount = action.likesCount;\n      state.posts[action.index].liked = action.liked;\n    }\n  }\n\n  const [showCreate, setShowCreate] = useState(false);\n  const [state, dispatch] = useReducer(immer(reducer), {\n    posts: [],\n  });\n\n  useEffect(() => {\n    getPosts();\n  }, []);\n\n  function getPosts() {\n    axios\n      .get(`${SERVER_URI}/p/post`, {\n        withCredentials: true,\n      })\n      .then((res) => {\n        dispatch({\n          type: \"setPosts\",\n          payload: res.data.posts,\n        });\n        console.log(res.data);\n        res.data.posts.forEach((post, ind) => getPostImg(post.post, ind));\n      });\n  }\n\n  function getPostImg(post, ind) {\n    axios\n      .get(`${SERVER_URI}/p/post-img/${post}`, {\n        withCredentials: true,\n        responseType: \"blob\",\n      })\n      .then((res) => {\n        const url = URL.createObjectURL(res.data);\n        dispatch({\n          type: \"updateImg\",\n          payload: url,\n          index: ind,\n        });\n      });\n  }\n\n  let posts = state.posts?.map((post, ind) => {\n    return (\n      <Post\n        post={{ ...post, editable: true }}\n        key={post.id}\n        logined={true}\n        editable={true}\n      />\n    );\n  });\n\n  function handleSubmit(e) {\n    e.preventDefault();\n    let form = e.target;\n    let data = {\n      post: form.post.files[0],\n      caption: form.caption.value,\n    };\n    setShowCreate(false);\n    console.log(form.post.files[0]);\n    axios\n      .post(`${SERVER_URI}/p/post`, data, {\n        withCredentials: true,\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n        },\n      })\n      .then((res) => {\n        getPosts();\n      });\n  }\n\n  useEffect(() => {\n    if (showCreate) {\n      window.addEventListener(\"scroll\", () => {\n        setShowCreate(false);\n      });\n    }\n  }, [showCreate]);\n\n  return (\n    <>\n      {posts}\n      {!showCreate &&\n        ReactDOM.createPortal(\n          <div\n            className=\"\"\n            style={{ position: \"fixed\", bottom: \"20px\", right: \"40px\" }}\n          >\n            <button onClick={() => setShowCreate(true)}>\n              <div className=\"rounded-full border-2 p-4 bg-inherit\">\n                <FaPlus style={{ width: \"25px\", height: \"25px\" }} />\n              </div>\n            </button>\n          </div>,\n          document.querySelector(\".overlay\")\n        )}\n      {showCreate && <Create handleSubmit={handleSubmit} />}\n      <div className=\"mt-18\"></div>\n    </>\n  );\n}\n\nexport default Postlist;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}